---
apt:
  - name:
      - git
      - vim
      # Package Installer for Python
      - python3-pip
      - python3-virtualenv
      - python3-wheel
      # Linters for Syntastic
      - flake8
      - shellcheck
      - tidy
      - yamllint

git_config:
  - name: core.excludesfile
    scope: global
    value: "{{ ansible_user_dir }}/.gitignore"
  - name: user.name
    scope: global
    value: 'Nafallo Bjälevik'
  - name: user.email
    scope: global
    state: absent
  - name: user.useconfigonly
    scope: global
    value: 'true'
  - name: user.signingkey
    scope: global
    value: 'C7751EEEBB7C949178B9A20F98138D4E2B151010'
  - name: commit.gpgsign
    scope: global
    value: 'true'
  - name: diff.submodule
    scope: global
    value: 'log'
  - name: status.submodulesummary
    scope: global
    value: 'true'
  - name: url.https://github.com/.insteadof
    scope: global
    value: 'gh:'
  - name: url.git+ssh://git@github.com/.pushinsteadof
    scope: global
    value: 'gh:'
  - name: url.https://git.launchpad.net/.insteadof
    scope: global
    value: 'lp:'
  - name: url.git+ssh://nafallo@git.launchpad.net/.pushinsteadof
    scope: global
    value: 'lp:'

git_files:
  - line: debug.yml
    path: "{{ ansible_user_dir}}/.gitignore"
  - line: '*.swp'
    path: "{{ ansible_user_dir}}/.gitignore"
  - line: '__pycache__'
    path: "{{ ansible_user_dir}}/.gitignore"
  - name: bash-git-prompt
    path: "{{ ansible_user_dir }}/.bashrc"
    block: |
      if [ -f "$HOME/.bash-git-prompt/gitprompt.sh" ]
      then
          GIT_PROMPT_ONLY_IN_REPO=1
          GIT_PROMPT_THEME=Custom
          source $HOME/.bash-git-prompt/gitprompt.sh
      fi
  - name: bash-git-prompt-theme
    path: "{{ ansible_user_dir }}/.git-prompt-colors.sh"
    block: |
      override_git_prompt_colors() {
        GIT_PROMPT_THEME_NAME="Custom"

        #Overrides the prompt_callback function used by bash-git-prompt
        function prompt_callback {
          GIT_CONTAINER_FOLDER_FULLPATH=$(git rev-parse --show-toplevel 2> /dev/null)
          GIT_CONTAINER_FOLDER=$(basename $GIT_CONTAINER_FOLDER_FULLPATH 2> /dev/null)
          CURRENT_FULLPATH=$(pwd)
          local PS1="$GIT_CONTAINER_FOLDER${CURRENT_FULLPATH#$GIT_CONTAINER_FOLDER_FULLPATH}"
          gp_set_window_title "$PS1"
          echo -n "${Yellow}$PS1${ResetColor}"
        }

        GIT_PROMPT_STAGED="${Yellow}●"
        GIT_PROMPT_STASHED="${BoldMagenta}⚑ "
        GIT_PROMPT_CLEAN="${Green}✔"

        GIT_PROMPT_START_USER=""
        GIT_PROMPT_START_ROOT="$GIT_PROMPT_START_USER"
        GIT_PROMPT_END_USER="${Yellow}\$${ResetColor} "
        GIT_PROMPT_END_ROOT="${Red}\#${ResetColor} "
      }

      reload_git_prompt_colors "Custom"

git_repos:
  - repo: 'https://github.com/magicmonty/bash-git-prompt.git'
    dest: "{{ ansible_user_dir }}/.bash-git-prompt"
    depth: 1

lpass_scripts:
  - git-credential-lastpass
